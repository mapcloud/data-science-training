<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Collaborative, Reproducible Science</title>
  <meta name="description" content="This is official data science training to for the Ocean Health Index.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Collaborative, Reproducible Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is official data science training to for the Ocean Health Index." />
  <meta name="github-repo" content="ohi-science/data-science-training" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Collaborative, Reproducible Science" />
  
  <meta name="twitter:description" content="This is official data science training to for the Ocean Health Index." />
  

<meta name="author" content="Ocean Health Index Team">


<meta name="date" content="2017-09-06">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="wrangling.html">
<link rel="next" href="rmarkdown.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Home</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#todo-license"><i class="fa fa-check"></i><b>1.1</b> TODO License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview and Prerequesites</a><ul>
<li class="chapter" data-level="2.1" data-path="overview.html"><a href="overview.html#prerequesites"><i class="fa fa-check"></i><b>2.1</b> Prerequesites</a></li>
<li class="chapter" data-level="2.2" data-path="overview.html"><a href="overview.html#credit"><i class="fa fa-check"></i><b>2.2</b> Credit</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="motivation.html"><a href="motivation.html"><i class="fa fa-check"></i><b>3</b> Motivation</a><ul>
<li class="chapter" data-level="3.1" data-path="motivation.html"><a href="motivation.html#welcome"><i class="fa fa-check"></i><b>3.1</b> Welcome</a></li>
<li class="chapter" data-level="3.2" data-path="motivation.html"><a href="motivation.html#collaboration"><i class="fa fa-check"></i><b>3.2</b> Collaboration</a></li>
<li class="chapter" data-level="3.3" data-path="motivation.html"><a href="motivation.html#reproducibility"><i class="fa fa-check"></i><b>3.3</b> Reproducibility</a></li>
<li class="chapter" data-level="3.4" data-path="motivation.html"><a href="motivation.html#mindset"><i class="fa fa-check"></i><b>3.4</b> Mindset</a></li>
<li class="chapter" data-level="3.5" data-path="motivation.html"><a href="motivation.html#data-science-is-a-discipline"><i class="fa fa-check"></i><b>3.5</b> Data science is a discipline</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="orientation.html"><a href="orientation.html"><i class="fa fa-check"></i><b>4</b> R and RStudio Orientation</a><ul>
<li class="chapter" data-level="4.1" data-path="orientation.html"><a href="orientation.html#objectives-resources"><i class="fa fa-check"></i><b>4.1</b> Objectives &amp; Resources</a></li>
<li class="chapter" data-level="4.2" data-path="orientation.html"><a href="orientation.html#why-learn-r-with-rstudio"><i class="fa fa-check"></i><b>4.2</b> Why learn R with RStudio</a></li>
<li class="chapter" data-level="4.3" data-path="orientation.html"><a href="orientation.html#r-at-the-console-rstudio-goodies"><i class="fa fa-check"></i><b>4.3</b> R at the console, RStudio goodies</a></li>
<li class="chapter" data-level="4.4" data-path="orientation.html"><a href="orientation.html#this-is-also-how-you-write-notes-in-your-code-to-explain-what-you-are-doing."><i class="fa fa-check"></i><b>4.4</b> this is also how you write notes in your code to explain what you are doing.</a><ul>
<li class="chapter" data-level="4.4.1" data-path="orientation.html"><a href="orientation.html#error-messages-are-your-friends"><i class="fa fa-check"></i><b>4.4.1</b> Error messages are your friends</a></li>
<li class="chapter" data-level="4.4.2" data-path="orientation.html"><a href="orientation.html#logical-operators-and-expressions"><i class="fa fa-check"></i><b>4.4.2</b> Logical operators and expressions</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="orientation.html"><a href="orientation.html#r-functions-help-pages"><i class="fa fa-check"></i><b>4.5</b> R functions, help pages</a><ul>
<li class="chapter" data-level="4.5.1" data-path="orientation.html"><a href="orientation.html#your-turn"><i class="fa fa-check"></i><b>4.5.1</b> Your turn</a></li>
<li class="chapter" data-level="4.5.2" data-path="orientation.html"><a href="orientation.html#your-turn-1"><i class="fa fa-check"></i><b>4.5.2</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="orientation.html"><a href="orientation.html#setup-git-github"><i class="fa fa-check"></i><b>4.6</b> Setup Git &amp; GitHub</a></li>
<li class="chapter" data-level="4.7" data-path="orientation.html"><a href="orientation.html#working-directory"><i class="fa fa-check"></i><b>4.7</b> Working directory</a></li>
<li class="chapter" data-level="4.8" data-path="orientation.html"><a href="orientation.html#rstudio-projects"><i class="fa fa-check"></i><b>4.8</b> RStudio projects</a><ul>
<li class="chapter" data-level="4.8.1" data-path="orientation.html"><a href="orientation.html#you-try"><i class="fa fa-check"></i><b>4.8.1</b> You try</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="orientation.html"><a href="orientation.html#troubleshooting"><i class="fa fa-check"></i><b>4.9</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="github-rstudio.html"><a href="github-rstudio.html"><i class="fa fa-check"></i><b>5</b> GitHub-RStudio Workflow and R Scripts</a><ul>
<li class="chapter" data-level="5.1" data-path="github-rstudio.html"><a href="github-rstudio.html#objectives-resources-1"><i class="fa fa-check"></i><b>5.1</b> Objectives &amp; Resources</a></li>
<li class="chapter" data-level="5.2" data-path="github-rstudio.html"><a href="github-rstudio.html#why-should-scientists-use-github"><i class="fa fa-check"></i><b>5.2</b> Why should scientists use Github?</a></li>
<li class="chapter" data-level="5.3" data-path="github-rstudio.html"><a href="github-rstudio.html#git-and-github"><i class="fa fa-check"></i><b>5.3</b> Git and Github</a><ul>
<li class="chapter" data-level="5.3.1" data-path="github-rstudio.html"><a href="github-rstudio.html#some-github-terminology"><i class="fa fa-check"></i><b>5.3.1</b> Some Github terminology</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="github-rstudio.html"><a href="github-rstudio.html#create-a-repository-on-your-github-account"><i class="fa fa-check"></i><b>5.4</b> Create a repository on your Github account</a><ul>
<li class="chapter" data-level="5.4.1" data-path="github-rstudio.html"><a href="github-rstudio.html#step-1"><i class="fa fa-check"></i><b>5.4.1</b> Step 1</a></li>
<li class="chapter" data-level="5.4.2" data-path="github-rstudio.html"><a href="github-rstudio.html#step-2"><i class="fa fa-check"></i><b>5.4.2</b> Step 2</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="github-rstudio.html"><a href="github-rstudio.html#clone-your-repository-using-rstudio"><i class="fa fa-check"></i><b>5.5</b> Clone your repository using RStudio</a><ul>
<li class="chapter" data-level="5.5.1" data-path="github-rstudio.html"><a href="github-rstudio.html#rstudio-projects-.rproj"><i class="fa fa-check"></i><b>5.5.1</b> RStudio projects (.Rproj)</a></li>
<li class="chapter" data-level="5.5.2" data-path="github-rstudio.html"><a href="github-rstudio.html#git-rstudio-troubleshooting"><i class="fa fa-check"></i><b>5.5.2</b> Git-RStudio Troubleshooting</a></li>
<li class="chapter" data-level="5.5.3" data-path="github-rstudio.html"><a href="github-rstudio.html#step-0"><i class="fa fa-check"></i><b>5.5.3</b> Step 0</a></li>
<li class="chapter" data-level="5.5.4" data-path="github-rstudio.html"><a href="github-rstudio.html#step-1-1"><i class="fa fa-check"></i><b>5.5.4</b> Step 1</a></li>
<li class="chapter" data-level="5.5.5" data-path="github-rstudio.html"><a href="github-rstudio.html#step-2-1"><i class="fa fa-check"></i><b>5.5.5</b> Step 2</a></li>
<li class="chapter" data-level="5.5.6" data-path="github-rstudio.html"><a href="github-rstudio.html#step-3"><i class="fa fa-check"></i><b>5.5.6</b> Step 3</a></li>
<li class="chapter" data-level="5.5.7" data-path="github-rstudio.html"><a href="github-rstudio.html#step-4"><i class="fa fa-check"></i><b>5.5.7</b> Step 4</a></li>
<li class="chapter" data-level="5.5.8" data-path="github-rstudio.html"><a href="github-rstudio.html#step-5"><i class="fa fa-check"></i><b>5.5.8</b> Step 5</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="github-rstudio.html"><a href="github-rstudio.html#add-files-to-local-repository-and-sync-to-remote-github.com"><i class="fa fa-check"></i><b>5.6</b> Add files to local repository and sync to remote (github.com)</a><ul>
<li class="chapter" data-level="5.6.1" data-path="github-rstudio.html"><a href="github-rstudio.html#pull"><i class="fa fa-check"></i><b>5.6.1</b> Pull</a></li>
<li class="chapter" data-level="5.6.2" data-path="github-rstudio.html"><a href="github-rstudio.html#stage"><i class="fa fa-check"></i><b>5.6.2</b> Stage</a></li>
<li class="chapter" data-level="5.6.3" data-path="github-rstudio.html"><a href="github-rstudio.html#commit"><i class="fa fa-check"></i><b>5.6.3</b> Commit</a></li>
<li class="chapter" data-level="5.6.4" data-path="github-rstudio.html"><a href="github-rstudio.html#push"><i class="fa fa-check"></i><b>5.6.4</b> Push</a></li>
<li class="chapter" data-level="5.6.5" data-path="github-rstudio.html"><a href="github-rstudio.html#repeat"><i class="fa fa-check"></i><b>5.6.5</b> Repeat!</a></li>
<li class="chapter" data-level="5.6.6" data-path="github-rstudio.html"><a href="github-rstudio.html#explore-remote-github"><i class="fa fa-check"></i><b>5.6.6</b> Explore remote Github</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="github-rstudio.html"><a href="github-rstudio.html#create-an-r-script"><i class="fa fa-check"></i><b>5.7</b> Create an R script</a><ul>
<li class="chapter" data-level="5.7.1" data-path="github-rstudio.html"><a href="github-rstudio.html#committing---how-often-tracking-changes-in-your-files"><i class="fa fa-check"></i><b>5.7.1</b> Committing - how often? Tracking changes in your files</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="github-rstudio.html"><a href="github-rstudio.html#troubleshooting-1"><i class="fa fa-check"></i><b>5.8</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="viz.html"><a href="viz.html"><i class="fa fa-check"></i><b>6</b> R and RStudio through Data Visualization</a><ul>
<li class="chapter" data-level="6.1" data-path="viz.html"><a href="viz.html#objectives-resources-2"><i class="fa fa-check"></i><b>6.1</b> Objectives &amp; Resources</a></li>
<li class="chapter" data-level="6.2" data-path="viz.html"><a href="viz.html#install-our-first-package-ggplot2"><i class="fa fa-check"></i><b>6.2</b> Install our first package: <code>ggplot2</code></a></li>
<li class="chapter" data-level="6.3" data-path="viz.html"><a href="viz.html#first-steps"><i class="fa fa-check"></i><b>6.3</b> First Steps</a></li>
<li class="chapter" data-level="6.4" data-path="viz.html"><a href="viz.html#aesthetic-mappings"><i class="fa fa-check"></i><b>6.4</b> Aesthetic mappings</a><ul>
<li class="chapter" data-level="6.4.1" data-path="viz.html"><a href="viz.html#your-turn-2"><i class="fa fa-check"></i><b>6.4.1</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="viz.html"><a href="viz.html#common-problems"><i class="fa fa-check"></i><b>6.5</b> Common problems</a></li>
<li class="chapter" data-level="6.6" data-path="viz.html"><a href="viz.html#coordinate-systems"><i class="fa fa-check"></i><b>6.6</b> Coordinate systems</a><ul>
<li class="chapter" data-level="6.6.1" data-path="viz.html"><a href="viz.html#your-turn-3"><i class="fa fa-check"></i><b>6.6.1</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="viz.html"><a href="viz.html#the-layered-grammar-of-graphics"><i class="fa fa-check"></i><b>6.7</b> The Layered Grammar of Graphics</a></li>
<li class="chapter" data-level="6.8" data-path="viz.html"><a href="viz.html#troubleshooting-2"><i class="fa fa-check"></i><b>6.8</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="wrangling.html"><a href="wrangling.html"><i class="fa fa-check"></i><b>7</b> Data wrangling with the tidyverse</a><ul>
<li class="chapter" data-level="7.1" data-path="wrangling.html"><a href="wrangling.html#overview-resources"><i class="fa fa-check"></i><b>7.1</b> Overview &amp; Resources</a></li>
<li class="chapter" data-level="7.2" data-path="wrangling.html"><a href="wrangling.html#tidy-data"><i class="fa fa-check"></i><b>7.2</b> Tidy Data</a><ul>
<li class="chapter" data-level="7.2.1" data-path="wrangling.html"><a href="wrangling.html#setup"><i class="fa fa-check"></i><b>7.2.1</b> setup</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="dplyr-overview.html"><a href="dplyr-overview.html"><i class="fa fa-check"></i><b>8</b> <code>dplyr</code> overview</a><ul>
<li class="chapter" data-level="8.0.1" data-path="dplyr-overview.html"><a href="dplyr-overview.html#install-dplyr-todo-tidyverse"><i class="fa fa-check"></i><b>8.0.1</b> install <code>dplyr</code> // TODO:: <code>tidyverse</code></a></li>
<li class="chapter" data-level="8.1" data-path="dplyr-overview.html"><a href="dplyr-overview.html#meet-your-first-data.frame-gapminder"><i class="fa fa-check"></i><b>8.1</b> Meet your first data.frame: gapminder</a><ul>
<li class="chapter" data-level="8.1.1" data-path="dplyr-overview.html"><a href="dplyr-overview.html#look-at-the-variables-inside-a-data.frame"><i class="fa fa-check"></i><b>8.1.1</b> Look at the variables inside a data.frame</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="dplyr-overview.html"><a href="dplyr-overview.html#use-dplyrfilter-to-subset-data-row-wise-observations."><i class="fa fa-check"></i><b>8.2</b> Use <code>dplyr::filter()</code> to subset data row-wise (observations).</a><ul>
<li class="chapter" data-level="8.2.1" data-path="dplyr-overview.html"><a href="dplyr-overview.html#your-turn-4"><i class="fa fa-check"></i><b>8.2.1</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="dplyr-overview.html"><a href="dplyr-overview.html#meet-the-new-pipe-operator"><i class="fa fa-check"></i><b>8.3</b> Meet the new pipe operator</a></li>
<li class="chapter" data-level="8.4" data-path="dplyr-overview.html"><a href="dplyr-overview.html#use-dplyrselect-to-subset-data-column-wise-variables"><i class="fa fa-check"></i><b>8.4</b> Use <code>dplyr::select()</code> to subset data column-wise (variables)</a></li>
<li class="chapter" data-level="8.5" data-path="dplyr-overview.html"><a href="dplyr-overview.html#revel-in-the-convenience"><i class="fa fa-check"></i><b>8.5</b> Revel in the convenience</a></li>
<li class="chapter" data-level="8.6" data-path="dplyr-overview.html"><a href="dplyr-overview.html#use-mutate-to-add-new-variables"><i class="fa fa-check"></i><b>8.6</b> Use <code>mutate()</code> to add new variables</a></li>
<li class="chapter" data-level="8.7" data-path="dplyr-overview.html"><a href="dplyr-overview.html#group_by-and-summarize"><i class="fa fa-check"></i><b>8.7</b> <code>group_by</code> and <code>summarize</code></a></li>
<li class="chapter" data-level="8.8" data-path="dplyr-overview.html"><a href="dplyr-overview.html#todo-variable-classes"><i class="fa fa-check"></i><b>8.8</b> TODO: variable classes?</a></li>
<li class="chapter" data-level="8.9" data-path="dplyr-overview.html"><a href="dplyr-overview.html#tidyr-overview"><i class="fa fa-check"></i><b>8.9</b> <code>tidyr</code> overview</a><ul>
<li class="chapter" data-level="8.9.1" data-path="dplyr-overview.html"><a href="dplyr-overview.html#install-tidyr-investigate-gapminder-data"><i class="fa fa-check"></i><b>8.9.1</b> Install <code>tidyr</code>, investigate gapminder data</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="dplyr-overview.html"><a href="dplyr-overview.html#from-wide-to-long-format-with-gather"><i class="fa fa-check"></i><b>8.10</b> From wide to long format with <code>gather()</code></a></li>
<li class="chapter" data-level="8.11" data-path="dplyr-overview.html"><a href="dplyr-overview.html#from-long-to-intermediate-format-with-spread"><i class="fa fa-check"></i><b>8.11</b> From long to intermediate format with spread()</a></li>
<li class="chapter" data-level="8.12" data-path="dplyr-overview.html"><a href="dplyr-overview.html#clean-up-and-save-your-.r-script"><i class="fa fa-check"></i><b>8.12</b> clean up and save your .r script</a></li>
<li class="chapter" data-level="8.13" data-path="dplyr-overview.html"><a href="dplyr-overview.html#other-tidyr-awesomeness"><i class="fa fa-check"></i><b>8.13</b> Other tidyr awesomeness</a></li>
<li class="chapter" data-level="8.14" data-path="dplyr-overview.html"><a href="dplyr-overview.html#importing-data"><i class="fa fa-check"></i><b>8.14</b> Importing data</a></li>
<li class="chapter" data-level="8.15" data-path="dplyr-overview.html"><a href="dplyr-overview.html#other-links"><i class="fa fa-check"></i><b>8.15</b> Other links</a></li>
<li class="chapter" data-level="8.16" data-path="dplyr-overview.html"><a href="dplyr-overview.html#troubleshooting-3"><i class="fa fa-check"></i><b>8.16</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>9</b> Analysis with RMarkdown</a><ul>
<li class="chapter" data-level="9.1" data-path="rmarkdown.html"><a href="rmarkdown.html#objectives"><i class="fa fa-check"></i><b>9.1</b> Objectives</a></li>
<li class="chapter" data-level="9.2" data-path="rmarkdown.html"><a href="rmarkdown.html#intro-to-markdown"><i class="fa fa-check"></i><b>9.2</b> Intro to Markdown</a></li>
<li class="chapter" data-level="9.3" data-path="rmarkdown.html"><a href="rmarkdown.html#intro-to-rmarkdown"><i class="fa fa-check"></i><b>9.3</b> Intro to RMarkdown</a></li>
<li class="chapter" data-level="9.4" data-path="rmarkdown.html"><a href="rmarkdown.html#more-practice-data-wrangling-data-viz"><i class="fa fa-check"></i><b>9.4</b> More practice data wrangling, data viz</a></li>
<li class="chapter" data-level="9.5" data-path="rmarkdown.html"><a href="rmarkdown.html#functions-for-loops"><i class="fa fa-check"></i><b>9.5</b> functions, for loops</a></li>
<li class="chapter" data-level="9.6" data-path="overview.html"><a href="overview.html#overview"><i class="fa fa-check"></i><b>9.6</b> Overview</a></li>
<li class="chapter" data-level="9.7" data-path="rmarkdown.html"><a href="rmarkdown.html#update-the-readme"><i class="fa fa-check"></i><b>9.7</b> Update the README</a></li>
<li class="chapter" data-level="9.8" data-path="rmarkdown.html"><a href="rmarkdown.html#tips"><i class="fa fa-check"></i><b>9.8</b> Tips</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="collaborate.html"><a href="collaborate.html"><i class="fa fa-check"></i><b>10</b> Collaborate with GitHub</a><ul>
<li class="chapter" data-level="10.1" data-path="collaborate.html"><a href="collaborate.html#objectives-1"><i class="fa fa-check"></i><b>10.1</b> Objectives</a></li>
<li class="chapter" data-level="10.2" data-path="collaborate.html"><a href="collaborate.html#pull-request-to-your-friends-repo"><i class="fa fa-check"></i><b>10.2</b> pull request to your friend’s repo</a></li>
<li class="chapter" data-level="10.3" data-path="collaborate.html"><a href="collaborate.html#create-gh-pages-repo-and-give-someone-permission"><i class="fa fa-check"></i><b>10.3</b> create gh-pages repo and give someone permission</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="power.html"><a href="power.html"><i class="fa fa-check"></i><b>11</b> More R poweR</a><ul>
<li class="chapter" data-level="11.1" data-path="power.html"><a href="power.html#objectives-2"><i class="fa fa-check"></i><b>11.1</b> Objectives</a></li>
<li class="chapter" data-level="11.2" data-path="power.html"><a href="power.html#subsetting-data"><i class="fa fa-check"></i><b>11.2</b> Subsetting data</a><ul>
<li class="chapter" data-level="11.2.1" data-path="power.html"><a href="power.html#subsetting-with-base-rows-columns-notatation"><i class="fa fa-check"></i><b>11.2.1</b> subsetting with base <code>[rows, columns]</code> notatation</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="power.html"><a href="power.html#subset-numeric-data"><i class="fa fa-check"></i><b>11.3</b> subset numeric data</a></li>
<li class="chapter" data-level="11.4" data-path="power.html"><a href="power.html#subset-factors"><i class="fa fa-check"></i><b>11.4</b> subset factors</a><ul>
<li class="chapter" data-level="11.4.1" data-path="power.html"><a href="power.html#subsetting-with-base-subset-function"><i class="fa fa-check"></i><b>11.4.1</b> subsetting with base <code>subset()</code> function</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="power.html"><a href="power.html#subset-gapminder"><i class="fa fa-check"></i><b>11.5</b> subset gapminder</a></li>
<li class="chapter" data-level="11.6" data-path="power.html"><a href="power.html#repeating-operations-with-for-loops"><i class="fa fa-check"></i><b>11.6</b> Repeating operations with for loops</a></li>
<li class="chapter" data-level="11.7" data-path="power.html"><a href="power.html#plot-population-of-some-countries"><i class="fa fa-check"></i><b>11.7</b> plot population of some countries</a></li>
<li class="chapter" data-level="11.8" data-path="power.html"><a href="power.html#conditional-statements-with-if-and-else"><i class="fa fa-check"></i><b>11.8</b> conditional statements with <code>if</code> and <code>else</code></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Collaborative, Reproducible Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr-overview" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> <code>dplyr</code> overview</h1>
<p>There are five <code>dplyr</code> functions that you will use to do the vast majority of data manipulations:</p>
<ul>
<li><strong>pick observations by their values (<code>filter()</code>)</strong>,
<ul>
<li><img src="img/rstudio-cheatsheet-filter.png" width="300"/></li>
</ul></li>
<li><strong>pick variables by their names (<code>select()</code>)</strong>,
<ul>
<li><img src="img/rstudio-cheatsheet-select.png" width="300"/></li>
</ul></li>
<li><strong>create new variables with functions of existing variables (<code>mutate()</code>)</strong>,
<ul>
<li><img src="img/rstudio-cheatsheet-mutate.png" width="300"/></li>
</ul></li>
<li><strong>collapse many values down to a single summary (<code>summarise()</code>)</strong>,
<ul>
<li><img src="img/rstudio-cheatsheet-summarise.png" width="300"/></li>
</ul></li>
<li><strong>reorder the rows (<code>arrange()</code>)</strong></li>
</ul>
<p>These can all be used in conjunction with <code>group_by()</code> which changes the scope of each function from operating on the entire dataset to operating on it group-by-group. These six functions provide the verbs for a language of data manipulation.</p>
<p>All verbs work similarly:</p>
<ol style="list-style-type: decimal">
<li>The first argument is a data frame.</li>
<li>The subsequent arguments describe what to do with the data frame. You can refer to columns in the data frame directly without using <code>$</code>.</li>
<li>The result is a new data frame.</li>
</ol>
<p>Together these properties make it easy to chain together multiple simple steps to achieve a complex result.</p>
<div id="install-dplyr-todo-tidyverse" class="section level3">
<h3><span class="header-section-number">8.0.1</span> install <code>dplyr</code> // TODO:: <code>tidyverse</code></h3>
<p>Packages are bundles of functions, along with help pages and other goodies that make them easier for others to use, (ie. vignettes).</p>
<p>So far we’ve been using packages included in ‘base R’; they are ‘out-of-the-box’ functions. You can also install packages from online. The most traditional is <a href="https://cran.r-project.org/">CRAN, the Comprehensive R Archive Network</a>. This is where you went to download R originally, and will go again to look for updates.</p>
<p>You don’t need to go to CRAN’s website to install packages, we can do it from within R with the command <code>install.packages(&quot;package-name-in-quotes&quot;)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## from CRAN:
<span class="co">#install.packages(&quot;dplyr&quot;) ## do this once only to install the package on your computer.</span>
<span class="kw">library</span>(dplyr) ## do this every time you restart R and need it </code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<p>What’s the difference between <code>install.packages()</code> and <code>library()</code>? Why do you need both? Here’s my analogy:</p>
<ul>
<li><code>install.packages()</code> is setting up electricity for your house. Just need to do this once (let’s ignore monthly bills).</li>
<li><code>library()</code> is turning on the lights. You only turn them on when you need them, otherwise it wouldn’t be efficient. And when you quit R, it turns the lights off, but the electricity lines are still there. So when you come back, you’ll have to turn them on again with <code>library()</code>, but you already have your electricity set up.</li>
</ul>
</div>
<div id="meet-your-first-data.frame-gapminder" class="section level2">
<h2><span class="header-section-number">8.1</span> Meet your first data.frame: gapminder</h2>
<p>We will work with some of the data from the <a href="http://www.gapminder.org">Gapminder project</a>. Have a look at <code>data/gapminder.csv</code> by navigating to it in the RStudio file pane and looking at it (RStudio is also a text editor so you can read this file right here).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## read gapminder csv
gapminder &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/gapminder.csv&#39;</span>)</code></pre></div>
<p>Let’s inspect:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## explore the gapminder dataset
gapminder <span class="co"># this is super long! Let&#39;s inspect in different ways</span></code></pre></div>
<p>Let’s use <code>head</code> and <code>tail</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(gapminder) <span class="co"># shows first 6</span>
<span class="kw">tail</span>(gapminder) <span class="co"># shows last 6</span>

<span class="kw">head</span>(gapminder, <span class="dv">10</span>) <span class="co"># shows first X that you indicate</span>
<span class="kw">tail</span>(gapminder, <span class="dv">12</span>) <span class="co"># guess what this does!</span></code></pre></div>
<p><code>str()</code> will provide a sensible description of almost anything: when in doubt, just <code>str()</code> some of the recently created objects to get some ideas about what to do next.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(gapminder) <span class="co"># ?str - displays the structure of an object</span></code></pre></div>
<p><code>gapminder</code> is a <code>data.frame</code>. We aren’t going to get into the other types of data receptacles today (‘arrays’, ‘matrices’), because working with data.frames is what you should primarily use. Why?</p>
<ul>
<li>data.frames package related variables neatly together, great for analysis</li>
<li>most functions, including the latest and greatest packages actually <strong>require</strong> that your data be in a data.frame</li>
<li>data.frames can hold variables of different flavors such as
<ul>
<li>character data (country or continent names; “Factors”)</li>
<li>quantitative data (years, population; “Integers (int)” or “Numeric (num)”)</li>
<li>categorical information (male vs. female)</li>
</ul></li>
</ul>
<p>We can also see the <code>gapminder</code> variable in RStudio’s Environment pane (top right)</p>
<p>More ways to learn basic info on a data.frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(gapminder)
<span class="kw">dim</span>(gapminder)    <span class="co"># ?dim dimension</span>
<span class="kw">ncol</span>(gapminder)   <span class="co"># ?ncol number of columns; same as dim(gapminder)[1]</span>
<span class="kw">nrow</span>(gapminder)   <span class="co"># ?nrow number of rows; same as dim(gapminder)[2]</span></code></pre></div>
<p>We can combine using <code>c()</code> to reverse-engineer <code>dim()</code>! Just a side-note here, but I wanted to introduce you to <code>c()</code>: we’ll use it later.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="kw">nrow</span>(gapminder), <span class="kw">ncol</span>(gapminder)) <span class="co"># ?c combines values into a vector or list. </span></code></pre></div>
<p>A statistical overview can be obtained with <code>summary()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(gapminder)</code></pre></div>
<div id="look-at-the-variables-inside-a-data.frame" class="section level3">
<h3><span class="header-section-number">8.1.1</span> Look at the variables inside a data.frame</h3>
<p>To specify a single variable from a data.frame, use the dollar sign <code>$</code>. The <code>$</code> operator is a way to extract of replace parts of an object–check out the help menu for <code>$</code>. It’s a common operator you’ll see in R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder$lifeExp <span class="co"># very long! hard to make sense of...</span>
<span class="kw">head</span>(gapminder$lifeExp) <span class="co"># can do the same tests we tried before</span>
<span class="kw">str</span>(gapminder$lifeExp) <span class="co"># it is a single numeric vector</span>
<span class="kw">summary</span>(gapminder$lifeExp) <span class="co"># same information, just formatted slightly differently</span></code></pre></div>
</div>
</div>
<div id="use-dplyrfilter-to-subset-data-row-wise-observations." class="section level2">
<h2><span class="header-section-number">8.2</span> Use <code>dplyr::filter()</code> to subset data row-wise (observations).</h2>
<p>You will want to isolate bits of your data; maybe you want to just look at a single country or a few years. R calls this subsetting. There are several ways to do this. We’ll go through a few options in base R so that you’re familiar with them, and know how to read them. But then we’ll move on to a new, better, intuitive, and game changing way with the <code>dplyr</code> package afterwards.</p>
<p>First let’s read in the gapminder data. Earlier, we read in a <code>.csv</code> of the gapminder data. But Jenny Bryan has also released this as an R package, so you could also install it from CRAN and load it into as extra practice for loading packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&#39;gapminder&#39;) # instead of reading in the csv</span>
<span class="kw">library</span>(gapminder) <span class="co"># this is the package name</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(gapminder) <span class="co"># there&#39;s still a data frame named &#39;gapminder&#39;</span></code></pre></div>
<p><code>filter()</code> takes logical expressions and returns the rows for which all are <code>TRUE</code>.</p>
<p>Visually, we are doing this (thanks RStudio for your <a href="http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheatsheet</a>):</p>
<div class="figure">
<img src="img/rstudio-cheatsheet-filter.png" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(gapminder, lifeExp &lt;<span class="st"> </span><span class="dv">29</span>)
<span class="kw">filter</span>(gapminder, country ==<span class="st"> &quot;Mexico&quot;</span>)
<span class="kw">filter</span>(gapminder, country %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mexico&quot;</span>, <span class="st">&quot;Afghanistan&quot;</span>))</code></pre></div>
<p>Compare with some base R code to accomplish the same things</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder[gapminder$lifeExp &lt;<span class="st"> </span><span class="dv">29</span>, ] ## repeat `gapminder`, [i, j] indexing is distracting
<span class="kw">subset</span>(gapminder, country ==<span class="st"> &quot;Mexico&quot;</span>) ## almost same as filter ... but wait ...</code></pre></div>
<div id="your-turn-4" class="section level3">
<h3><span class="header-section-number">8.2.1</span> Your turn</h3>
<p>visualize with ggplot2</p>
</div>
</div>
<div id="meet-the-new-pipe-operator" class="section level2">
<h2><span class="header-section-number">8.3</span> Meet the new pipe operator</h2>
<p>Before we go any further, we should exploit the new pipe operator that <code>dplyr</code> imports from the <a href="https://github.com/smbache/magrittr"><code>magrittr</code></a> package by Stefan Bache. <strong>This is going to change your data analytical life</strong>. You no longer need to enact multi-operation commands by nesting them inside each other. This new syntax leads to code that is much easier to write and to read.</p>
<p>Here’s what it looks like: <code>%&gt;%</code>. The RStudio keyboard shortcut: Ctrl + Shift + M (Windows), Cmd + Shift + M (Mac).</p>
<p>Let’s demo then I’ll explain:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder %&gt;%<span class="st"> </span><span class="kw">head</span>()</code></pre></div>
<p>This is equivalent to <code>head(gapminder)</code>. This pipe operator takes the thing on the left-hand-side and <strong>pipes</strong> it into the function call on the right-hand-side – literally, drops it in as the first argument.</p>
<p>Never fear, you can still specify other arguments to this function! To see the first 3 rows of Gapminder, we could say <code>head(gapminder, 3)</code> or this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder %&gt;%<span class="st"> </span><span class="kw">head</span>(<span class="dv">3</span>)</code></pre></div>
<p><strong>I’ve advised you to think “gets” whenever you see the assignment operator, <code>&lt;-</code>. Similary, you should think “and then” whenever you see the pipe operator, <code>%&gt;%</code>.</strong></p>
<p>You are probably not impressed yet, but the magic will soon happen.</p>
</div>
<div id="use-dplyrselect-to-subset-data-column-wise-variables" class="section level2">
<h2><span class="header-section-number">8.4</span> Use <code>dplyr::select()</code> to subset data column-wise (variables)</h2>
<p>Back to <code>dplyr</code> …</p>
<p>Use <code>select()</code> to subset the data on variables or columns.</p>
<p>Visually, we are doing this (thanks RStudio for your <a href="http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheatsheet</a>):</p>
<div class="figure">
<img src="img/rstudio-cheatsheet-select.png" />

</div>
<p>Here’s a conventional call:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(gapminder, year, lifeExp) </code></pre></div>
<p>But using what we just learned, with a pipe, we can do this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder %&gt;%<span class="st"> </span><span class="kw">select</span>(year, lifeExp)</code></pre></div>
<p>Let’s write it again but using multiple lines so it’s nicer to read. And let’s add a second pipe operator to pipe through <code>head</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder %&gt;%
<span class="st">  </span><span class="kw">select</span>(year, lifeExp) %&gt;%
<span class="st">  </span><span class="kw">head</span>(<span class="dv">4</span>)</code></pre></div>
<p>Think: “Take <code>gapminder</code>, then select the variables year and lifeExp, then show the first 4 rows.”</p>
</div>
<div id="revel-in-the-convenience" class="section level2">
<h2><span class="header-section-number">8.5</span> Revel in the convenience</h2>
<p>Let’s do a little analysis where we calculate the mean gdp for Cambodia.</p>
<p>Here’s the gapminder data for Cambodia, but only certain variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder %&gt;%
<span class="st">  </span><span class="kw">filter</span>(country ==<span class="st"> &quot;Cambodia&quot;</span>) %&gt;%
<span class="st">  </span><span class="co"># select(country, year, pop, gdpPercap) ## entering 4 of the 6 columns is tedious</span>
<span class="st">  </span><span class="kw">select</span>(-continent, -lifeExp) <span class="co"># you can use - to deselect columns</span></code></pre></div>
<p>and what a typical base R call would look like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder[gapminder$country ==<span class="st"> &quot;Cambodia&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;pop&quot;</span>, <span class="st">&quot;gdpPercap&quot;</span>)]</code></pre></div>
<p>or, possibly?, a nicer look using base R’s <code>subset()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">subset</span>(gapminder, country ==<span class="st"> &quot;Cambodia&quot;</span>, <span class="dt">select =</span> <span class="kw">c</span>(country, year, pop, gdpPercap))</code></pre></div>
</div>
<div id="use-mutate-to-add-new-variables" class="section level2">
<h2><span class="header-section-number">8.6</span> Use <code>mutate()</code> to add new variables</h2>
<p>Imagine we wanted to recover each country’s GDP. After all, the Gapminder data has a variable for population and GDP per capita. Let’s add a new column and multiply them together.</p>
<p>Visually, we are doing this (thanks RStudio for your <a href="http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheatsheet</a>):</p>
<div class="figure">
<img src="img/rstudio-cheatsheet-mutate.png" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp =</span> pop *<span class="st"> </span>gdpPercap)</code></pre></div>
<blockquote>
<p>Exercise: add this new gdp column to our Cambodia example above.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Solution (no peeking!)</span>
gapminder %&gt;%
<span class="st">  </span><span class="kw">filter</span>(country ==<span class="st"> &quot;Cambodia&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(-continent, -lifeExp) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp =</span> pop *<span class="st"> </span>gdpPercap)</code></pre></div>
</div>
<div id="group_by-and-summarize" class="section level2">
<h2><span class="header-section-number">8.7</span> <code>group_by</code> and <code>summarize</code></h2>
<p>Great! And now we want to calculate the mean gdp across all years (Let’s pretend that’s a good idea statistically)</p>
<p>Visually, we are doing this (thanks RStudio for your <a href="http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheatsheet</a>):</p>
<div class="figure">
<img src="img/rstudio-cheatsheet-summarise.png" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder %&gt;%
<span class="st">  </span><span class="kw">filter</span>(country ==<span class="st"> &quot;Cambodia&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(-continent, -lifeExp) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp =</span> pop *<span class="st"> </span>gdpPercap) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(country) %&gt;%
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean_gdp =</span> <span class="kw">mean</span>(gdp)) %&gt;%
<span class="st">  </span><span class="kw">ungroup</span>() <span class="co"># if you use group_by, also use ungroup() to save heartache later</span></code></pre></div>
<!---

## Remember our for loop?

And how would you then do this for every country, not just Cambodia? Well, yesterday we would have been thinking about putting this whole analysis inside a for loop, replacing "Cambodia" with a new name each time we iterated through the loop. But today, we have it already, just need to *delete* one line from our analysis--we don't need to filter out Cambodia anymore!! 

--->
<p>Visually, we are doing this (thanks RStudio for your <a href="http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheatsheet</a>):</p>
<div class="figure">
<img src="img/rstudio-cheatsheet-group_by.png" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder %&gt;%
<span class="st">  </span><span class="kw">select</span>(-continent, -lifeExp) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp =</span> pop *<span class="st"> </span>gdpPercap) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(country) %&gt;%
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean_gdp =</span> <span class="kw">mean</span>(gdp)) %&gt;%
<span class="st">  </span><span class="kw">ungroup</span>() <span class="co"># if you use group_by, also use ungroup() to save heartache later</span></code></pre></div>
<p>So we have done a pretty incredible amount of work in a few lines. Our whole analysis is this. Imagine the possibilities from here. It’s very readable: you see the data as the first thing, it’s not nested. Then, you can read the verbs. This is the whole thing:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(gapminder)

gapminder %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(-continent, -lifeExp) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp =</span> pop *<span class="st"> </span>gdpPercap) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(country) %&gt;%
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean_gdp =</span> <span class="kw">mean</span>(gdp)) %&gt;%
<span class="st">  </span><span class="kw">ungroup</span>() <span class="co"># if you use group_by, also use ungroup() to save heartache later</span></code></pre></div>
<p>(In base-R, this would be a nightmare to read, and you would also have to make many temporary variables since you couldn’t use the %&gt;% operator. Have a look at this blog to get an idea: <a href="http://www.statsblogs.com/2014/02/10/how-dplyr-replaced-my-most-common-r-idioms/">How dplyr replaced my most common R idioms</a>).</p>
<blockquote>
<p>Exercise: with your neighbor, find the maximum life expectancy for countries in Asia. What is the earliest year you enounter? The latest? Hint: you can use or <code>base::max</code> and <code>dplyr::arrange()</code>…</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## possible result--no peeking!!
gapminder %&gt;%
<span class="st">  </span><span class="kw">filter</span>(continent ==<span class="st"> &#39;Asia&#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(country) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(lifeExp ==<span class="st"> </span><span class="kw">max</span>(lifeExp)) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(year))</code></pre></div>
</div>
<div id="todo-variable-classes" class="section level2">
<h2><span class="header-section-number">8.8</span> TODO: variable classes?</h2>
<p>Let’s explore a numeric variable: life expectancy.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## explore numeric variable
<span class="kw">summary</span>(gapminder$lifeExp)
<span class="kw">hist</span>(gapminder$lifeExp)</code></pre></div>
<p>Let’s explore a categorical variable (stored as a <em>factor</em> in R): continent.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## explore factor variable
<span class="kw">summary</span>(gapminder$continent)
<span class="kw">levels</span>(gapminder$continent)
<span class="kw">nlevels</span>(gapminder$continent)
<span class="kw">hist</span>(gapminder$continent) <span class="co"># whaaaa!?</span></code></pre></div>
<p>This error is because of what factors are ‘under the hood’: R is really storing integer codes 1, 2, 3 here, but represent them as text to us. Factors can be problematic to us because of this, but you can learn to navigate with them. There are resources to learn how to <a href="http://stat545.com/block014_factors.html">properly care and feed for factors</a>.</p>
<p>One thing you’ll learn is how to visualize factors with which functions/packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(gapminder$continent) <span class="co"># ?class returns the class type of the object</span>
<span class="kw">table</span>(gapminder$continent) <span class="co"># ?table builds a table based on factor levels </span>
<span class="kw">class</span>(<span class="kw">table</span>(gapminder$continent)) <span class="co"># this has morphed the factor...</span>
<span class="kw">hist</span>(<span class="kw">table</span>(gapminder$continent)) <span class="co"># so we can plot!</span></code></pre></div>
<p>I don’t want us to get too bogged down with what’s going on with <code>table()</code> and plotting factors, but I want to expose you to these situations because you will encounter them. Googling the error messages you get, and knowing how to look for good responses is a critical skill. (I tend to look for responses from stackoverflow.com that are recent and have green checks, and ignore snarky comments).</p>
<blockquote>
<p>Exercise with your neighbor: Explore <code>gapminder$gdpPercap</code>. What kind of data is it? So which commands do you use?</p>
</blockquote>
</div>
<div id="tidyr-overview" class="section level2">
<h2><span class="header-section-number">8.9</span> <code>tidyr</code> overview</h2>
<p>Often, data must be reshaped for it to become tidy data. What does that mean? There are four main verbs we’ll use, which are essentially pairs of opposites:</p>
<ul>
<li>turn columns into rows (<code>gather()</code>),</li>
<li>turn rows into columns (<code>spread()</code>),</li>
<li>turn a character column into multiple columns (<code>separate()</code>),</li>
<li>turn multiple character columns into a single column (<code>unite()</code>)</li>
</ul>
<div class="figure">
<img src="img/rstudio-cheatsheet-spread-gather-sep-unite.png" />

</div>
<p>You use <code>spread()</code> and <code>gather()</code> to transform or reshape data between ‘wide’ to ‘long’ formats. ‘long’ format is the tidy data we are after, where:</p>
<ul>
<li>each column is a variable</li>
<li>each row is an observation</li>
</ul>
<p>In the ‘long’ format, you usually have 1 column for the observed variable and the other columns are ID variables.</p>
<p>For the ‘wide’ format each row is often a site/subject/patient and you have multiple observation variables containing the same type of data. These can be either repeated observations over time, or observation of multiple variables (or a mix of both). Data input may be simpler or some other applications may prefer the ‘wide’ format. However, many of <code>R</code>‘s functions have been designed assuming you have ’long’ format data.</p>
<p>These data formats mainly affect readability. For humans, the wide format is often more intuitive since we can often see more of the data on the screen due to it’s shape. However, the long format is more machine readable and is closer to the formating of databases. The ID variables in our dataframes are similar to the fields in a database and observed variables are like the database values.</p>
<blockquote>
<p>Question: Is gapminder a purely long, purely wide, or some intermediate format?</p>
</blockquote>
<p>Sometimes, as with the gapminder dataset, we have multiple types of observed data. It is somewhere in between the purely ‘long’ and ‘wide’ data formats:</p>
<ul>
<li>3 “ID variables” (<code>continent</code>, <code>country</code>, <code>year</code>)</li>
<li>3 “Observation variables” (<code>pop</code>,<code>lifeExp</code>,<code>gdpPercap</code>).</li>
</ul>
<p>It’s pretty common to have data in this intermediate format in most cases despite not having ALL observations in 1 column, since all 3 observation variables have different units. But we can play with switching it to long format and wide to show what that means (i.e. long would be 4 ID variables and 1 Observation variable).</p>
<p><strong>Note:</strong> Generally, mathematical operations are better in long format, although some plotting functions actually work better with wide format.</p>
<div id="install-tidyr-investigate-gapminder-data" class="section level3">
<h3><span class="header-section-number">8.9.1</span> Install <code>tidyr</code>, investigate gapminder data</h3>
<p>First install and load <code>tidyr</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;tidyr&quot;)</span>
<span class="kw">library</span>(<span class="st">&quot;tidyr&quot;</span>) <span class="co"># warning messages are OK</span></code></pre></div>
</div>
</div>
<div id="from-wide-to-long-format-with-gather" class="section level2">
<h2><span class="header-section-number">8.10</span> From wide to long format with <code>gather()</code></h2>
<img src="img/rstudio-cheatsheet-reshaping-data-gather.png" width="500"/>
<p>We’ve been working with pretty tidy data. So for practice, now let’s work with these data in a wider format, maybe the way you or your colleague entered it in a spreadsheet. We’ll work with it to get it back to the way we like it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap_wide &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/gapminder_wide.csv&#39;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(gap_wide)
<span class="kw">str</span>(gap_wide)</code></pre></div>
<p>While wide format is nice for data entry, it’s not nice for calculations. What if you were asked for the mean population after 1990 in Algeria? Possible, but ugly. Let’s tidy it back to the intermediate format we’ve been using.</p>
<blockquote>
<p>Question: let’s talk this through together. If we’re trying to turn the <code>gap_wide</code> format into <code>gapminder</code> format, what structure does it have that we like? And that we want to change?</p>
</blockquote>
<ul>
<li>We like the continent and country columns. We won’t want to change those.</li>
<li>For long format, we’d want just 1 column identifying the variable name (<code>tidyr</code> calls this a <strong>‘key’</strong>), and 1 column for the data (<code>tidyr</code> calls this the ’<strong>value’</strong>).</li>
<li>For intermediate format, we’d want 3 columns for <code>gdpPercap</code>, <code>lifeExp</code>, and <code>pop</code>.</li>
<li>We would like year as a separate column.</li>
</ul>
<p>Let’s get it to long format. We’ll have to do this in 2 steps. The first step is to take all of those column names and make them a variable in a new column, and transfer the values into another column.</p>
<p>Let’s have a look at <code>gather()</code>’s help:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?gather</code></pre></div>
<blockquote>
<p>Question: What is our <strong>key-value pair</strong>?</p>
</blockquote>
<p>We need to name two new variables in the key-value pair, one for the key, one for the value. Let’s name them <code>obstype_year</code> and <code>obs_value</code>.</p>
<p>Here’s the start of what we’ll do:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap_long &lt;-<span class="st"> </span>gap_wide %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key   =</span> obstype_year,
         <span class="dt">value =</span> obs_values)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(gap_long)
<span class="kw">head</span>(gap_long)
<span class="kw">tail</span>(gap_long)</code></pre></div>
<p>So this has reshaped our dataframe, but really not how we wanted. Very important to check, and listen to that warning message–dropping attributes seems very suspicious. Like suspenders.</p>
<p>What went wrong? Notice that it didn’t know that we wanted to keep <code>continent</code> and <code>country</code> untouched; we need to give it more information about which columns we want reshaped. We can do this in several ways.</p>
<p>One way: identify the column numbers you want to use. Not ideal because column numbers could change, but it does exactly what we want! And illustrates it nicely.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap_long &lt;-<span class="st"> </span>gap_wide %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key   =</span> obstype_year,
         <span class="dt">value =</span> obs_values,
         <span class="dv">3</span>:<span class="dv">38</span>)  <span class="co"># could also do -1, -2: &#39;not column one, not column two</span>
<span class="kw">str</span>(gap_long)
<span class="kw">head</span>(gap_long)
<span class="kw">tail</span>(gap_long)</code></pre></div>
<p>Better way: identify the columns by name. Listing them out by explicit name can be a good approach if there are a few. But I’m not going to list them out here, and way too much potential for error if you tried gdpPercap_1952, gdpPercap_1957, gdpPercap_1962… So let’s use some of <code>dplyr</code>’s awesome helper functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap_long &lt;-<span class="st"> </span>gap_wide %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key   =</span> obstype_year,
         <span class="dt">value =</span> obs_values,
         dplyr::<span class="kw">starts_with</span>(<span class="st">&#39;pop&#39;</span>),
         dplyr::<span class="kw">starts_with</span>(<span class="st">&#39;lifeExp&#39;</span>),
         dplyr::<span class="kw">starts_with</span>(<span class="st">&#39;gdpPercap&#39;</span>))
<span class="kw">str</span>(gap_long)
<span class="kw">head</span>(gap_long)
<span class="kw">tail</span>(gap_long)</code></pre></div>
<p>Success! And you could also do it this way.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap_long &lt;-<span class="st"> </span>gap_wide %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key   =</span> obstype_year,
         <span class="dt">value =</span> obs_values,
         -continent, -country)
<span class="kw">str</span>(gap_long)
<span class="kw">head</span>(gap_long)
<span class="kw">tail</span>(gap_long)</code></pre></div>
<p>To recap:</p>
<p>Inside <code>gather()</code> we first name the new column for the new ID variable (<code>obstype_year</code>), the name for the new amalgamated observation variable (<code>obs_value</code>), then the names of the old observation variable. We could have typed out all the observation variables, but as in the <code>select()</code> function (see <code>dplyr</code> lesson), we can use the <code>starts_with()</code> argument to select all variables that starts with the desired character string. Gather also allows the alternative syntax of using the <code>-</code> symbol to identify which variables are not to be gathered (i.e. ID variables)</p>
<p>OK, but we’re not done yet. <code>obstype_year</code> actually contains 2 pieces of information, the observation type (<code>pop</code>,<code>lifeExp</code>, or <code>gdpPercap</code>) and the <code>year</code>. We can use the <code>separate()</code> function to split the character strings into multiple variables</p>
<p><code>?separate</code> –&gt; we’ll tell it which column we want separated, name new columns that we want to create, and tell it what we want it to separate by. Since the <code>obstype_year</code> variable has observation types and years separated by a <code>_</code>, we’ll use that.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap_long &lt;-<span class="st"> </span>gap_wide %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key   =</span> obstype_year,
         <span class="dt">value =</span> obs_values,
         -continent, -country) %&gt;%
<span class="st">  </span><span class="kw">separate</span>(obstype_year,
           <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&#39;obs_type&#39;</span>,<span class="st">&#39;year&#39;</span>),
           <span class="dt">sep=</span><span class="st">&quot;_&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(gap_long)
<span class="kw">head</span>(gap_long)
<span class="kw">tail</span>(gap_long)</code></pre></div>
<p>Excellent. This is long format: every row is a unique observation. Yay!</p>
<blockquote>
<p>Exercise: Using <code>gap_long</code>, calculate the mean life expectancy, population, and gdpPercap for each continent. <strong>Hint:</strong> use the <code>group_by()</code> and <code>summarize()</code> functions we learned in the <code>dplyr</code> lesson</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># solution (no peeking!)</span>
gap_long %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(continent, obs_type) %&gt;%
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">means =</span> <span class="kw">mean</span>(obs_values))</code></pre></div>
</div>
<div id="from-long-to-intermediate-format-with-spread" class="section level2">
<h2><span class="header-section-number">8.11</span> From long to intermediate format with spread()</h2>
<div class="figure">
<img src="img/rstudio-cheatsheet-reshaping-data-spread.png" />

</div>
<p>Now just to double-check our work, let’s use the opposite of <code>gather()</code> to spread our observation variables back to the original format with the aptly named <code>spread()</code>. You pass <code>spread()</code> the key and value pair, which is now <code>obs_type</code> and <code>obs_values</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap_normal &lt;-<span class="st"> </span>gap_long %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(obs_type, obs_values)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(gap_normal)
<span class="kw">dim</span>(gapminder)
<span class="kw">names</span>(gap_normal)
<span class="kw">names</span>(gapminder)</code></pre></div>
<p>Now we’ve got an intermediate dataframe <code>gap_normal</code> with the same dimensions as the original <code>gapminder</code>, but the order of the variables is different. Let’s fix that before checking if they are <code>all.equal()</code>.</p>
<blockquote>
<p>Exercise: reorder the columns in gap_normal to match gapminder.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Solution, no peeking!</span>

<span class="co"># one way with dplyr (also nice because can chain this from gap_normal creation)</span>
gap_normal &lt;-<span class="st"> </span>gap_normal %&gt;%
<span class="st">  </span><span class="kw">select</span>(country, continent, year, lifeExp, pop, gdpPercap)

<span class="co"># another way with base R</span>
gap_normal &lt;-<span class="st"> </span>gap_normal[,<span class="kw">names</span>(gapminder)]</code></pre></div>
<p>Now let’s check if they are all.equal (<code>?all.equal</code>) is a handy test</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">all.equal</span>(gap_normal,gapminder)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(gap_normal)
<span class="kw">head</span>(gapminder)</code></pre></div>
<p>We’re almost there, the original was sorted by <code>country</code>, <code>continent</code>, then <code>year</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gap_normal &lt;-<span class="st"> </span>gap_normal %&gt;%<span class="st"> </span><span class="kw">arrange</span>(country,continent,year)
<span class="kw">all.equal</span>(gap_normal,gapminder)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(gap_normal)
<span class="kw">str</span>(gapminder)</code></pre></div>
<p>Mine shows a slight difference because one is a data.frame and one is a tbl_df, which is similar to a data.frame. We won’t get into this difference now, I fm feeling good atout these data sets! We’ve gone from the longest format back to the intermediate and we didn’t introduce any errors in our code.</p>
<blockquote>
<p>Exercise: convert gap_long all the way back to gap_wide. Hint: you’ll need to create appropriate labels for all our new variables (time*metric combinations) with <code>tidyr::unite()</code>.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Solution, no peeking: </span>
<span class="kw">head</span>(gap_long) <span class="co"># remember the columns</span>

gap_wide_new &lt;-<span class="st"> </span>gap_long %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="co"># first unite obs_type and year into a new column called var_names. Separate by _</span>
<span class="st">  </span><span class="kw">unite</span>(<span class="dt">col =</span> var_names, obs_type, year, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="co"># then spread var_names out by key-value pair.</span>
<span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> var_names, <span class="dt">value =</span> obs_values)
<span class="kw">str</span>(gap_wide_new)</code></pre></div>
</div>
<div id="clean-up-and-save-your-.r-script" class="section level2">
<h2><span class="header-section-number">8.12</span> clean up and save your .r script</h2>
<p>Spend some time cleaning up and saving <code>gapminder-wrangle.r</code> Restart R. In RStudio, use <em>Session &gt; Restart R</em>. Otherwise, quit R with <code>q()</code> and re-launch it.</p>
<p>Your final R script could look something like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## install, load dplyr
<span class="co">#install.packages(&quot;dplyr&quot;) ## do this once only to install the package on your computer.</span>
<span class="kw">library</span>(dplyr)

## load gapminder
<span class="kw">library</span>(gapminder) <span class="co"># this is the package name</span>
<span class="kw">str</span>(gapminder) <span class="co"># there&#39;s still a data frame named &#39;gapminder&#39;</span>

## practice dplyr::filter()
<span class="kw">filter</span>(gapminder, lifeExp &lt;<span class="st"> </span><span class="dv">29</span>)
<span class="kw">filter</span>(gapminder, country ==<span class="st"> &quot;Mexico&quot;</span>)
<span class="kw">filter</span>(gapminder, country %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mexico&quot;</span>, <span class="st">&quot;Afghanistan&quot;</span>))

## base R alternatives to dplyr::filter()
gapminder[gapminder$lifeExp &lt;<span class="st"> </span><span class="dv">29</span>, ] ## repeat `gapminder`, [i, j] indexing is distracting
<span class="kw">subset</span>(gapminder, country ==<span class="st"> &quot;Mexico&quot;</span>) ## almost same as filter ... but wait ...

## pipe operator %&gt;%
gapminder %&gt;%<span class="st"> </span>head <span class="co"># this...</span>
<span class="kw">head</span>(gapminder) <span class="co"># ...is the same as this!</span>
gapminder %&gt;%<span class="st"> </span><span class="kw">head</span>(<span class="dv">3</span>) <span class="co"># can pass arguments! this...</span>
<span class="kw">head</span>(gapminder, <span class="dv">3</span>) <span class="co"># ...is the same as this!</span>

## practice dplyr::select() with %&gt;%
<span class="kw">select</span>(gapminder, year, lifeExp) <span class="co"># this...</span>
gapminder %&gt;%<span class="st"> </span><span class="kw">select</span>(year, lifeExp) <span class="co"># ...is the same as this!</span>

## practice with %&gt;% chains
gapminder %&gt;%
<span class="st">  </span><span class="kw">select</span>(year, lifeExp) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">4</span>) <span class="co"># doesn&#39;t have to be a dplyr function</span>

gapminder %&gt;%
<span class="st">  </span><span class="kw">filter</span>(country ==<span class="st"> &quot;Cambodia&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(-continent, -lifeExp) <span class="co"># same as select(country, year, pop, gdpPercap) </span>

<span class="co"># compare to base R, hard to read!</span>
gapminder[gapminder$country ==<span class="st"> &quot;Cambodia&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;pop&quot;</span>, <span class="st">&quot;gdpPercap&quot;</span>)]
<span class="kw">subset</span>(gapminder, country ==<span class="st"> &quot;Cambodia&quot;</span>, <span class="dt">select =</span> <span class="kw">c</span>(country, year, pop, gdpPercap))

## dplyr::mutate() adds new columns
gapminder %&gt;%
<span class="st">  </span><span class="kw">filter</span>(country ==<span class="st"> &quot;Cambodia&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(-continent, -lifeExp) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp =</span> pop *<span class="st"> </span>gdpPercap)

## dplyr::summarize() or summarise() adds new column when grouping
gapminder %&gt;%
<span class="st">  </span><span class="kw">filter</span>(country ==<span class="st"> &quot;Cambodia&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">select</span>(-continent, -lifeExp) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp =</span> pop *<span class="st"> </span>gdpPercap) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(country) %&gt;%
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean_gdp =</span> <span class="kw">mean</span>(gdp)) %&gt;%
<span class="st">  </span><span class="kw">ungroup</span>() <span class="co"># if you use group_by, also use ungroup() to save heartache later</span>

## summarize for all countries (replaces our for loop!)
gapminder %&gt;%
<span class="st">  </span><span class="kw">select</span>(-continent, -lifeExp) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp =</span> pop *<span class="st"> </span>gdpPercap) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(country) %&gt;%
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean_gdp =</span> <span class="kw">mean</span>(gdp)) %&gt;%
<span class="st">  </span><span class="kw">ungroup</span>() <span class="co"># if you use group_by, also use ungroup() to save heartache later</span>

## install tidyr
<span class="kw">install.packages</span>(<span class="st">&quot;tidyr&quot;</span>)
<span class="kw">library</span>(tidyr)

## load wide data
gap_wide &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/gapminder_wide.csv&#39;</span>)
<span class="kw">head</span>(gap_wide)
<span class="kw">str</span>(gap_wide)

## practice tidyr::gather() wide to long
gap_long &lt;-<span class="st"> </span>gap_wide %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key   =</span> obstype_year,
         <span class="dt">value =</span> obs_values,
         -continent, -country) 
<span class="co"># or </span>
gap_long &lt;-<span class="st"> </span>gap_wide %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key   =</span> obstype_year,
         <span class="dt">value =</span> obs_values,
         dplyr::<span class="kw">starts_with</span>(<span class="st">&#39;pop&#39;</span>),
         dplyr::<span class="kw">starts_with</span>(<span class="st">&#39;lifeExp&#39;</span>),
         dplyr::<span class="kw">starts_with</span>(<span class="st">&#39;gdpPercap&#39;</span>))
<span class="co"># or (but always be wary of numerics because they could change silently)</span>
gap_long &lt;-<span class="st"> </span>gap_wide %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key   =</span> obstype_year,
         <span class="dt">value =</span> obs_values,
         <span class="dv">3</span>:<span class="dv">38</span>)  <span class="co"># could also do -1, -2: &#39;not column one, not column two</span>


## gather() and separate() to create our original gapminder
gap_long &lt;-<span class="st"> </span>gap_wide %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key   =</span> obstype_year,
         <span class="dt">value =</span> obs_values,
         -continent, -country) %&gt;%
<span class="st">  </span><span class="kw">separate</span>(obstype_year,
           <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&#39;obs_type&#39;</span>,<span class="st">&#39;year&#39;</span>),
           <span class="dt">sep=</span><span class="st">&quot;_&quot;</span>)

## practice: can still do calculations in long format
gap_long %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(continent, obs_type) %&gt;%
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">means =</span> <span class="kw">mean</span>(obs_values))

## spread() from normal to wide
gap_normal &lt;-<span class="st"> </span>gap_long %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(obs_type, obs_values) %&gt;%
<span class="st">  </span><span class="kw">select</span>(country, continent, year, lifeExp, pop, gdpPercap)
<span class="co"># or </span>
gap_normal &lt;-<span class="st"> </span>gap_long %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(obs_type, obs_values)
gap_normal &lt;-<span class="st"> </span>gap_normal[,<span class="kw">names</span>(gapminder)]

## check that all.equal()
<span class="kw">all.equal</span>(gap_normal,gapminder)

## unite() and spread(): convert gap_long to gap_wide
<span class="kw">head</span>(gap_long) <span class="co"># remember the columns</span>

gap_wide_new &lt;-<span class="st"> </span>gap_long %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="co"># first unite obs_type and year into a new column called var_names. Separate by _</span>
<span class="st">  </span><span class="kw">unite</span>(<span class="dt">col =</span> var_names, obs_type, year, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="co"># then spread var_names out by key-value pair.</span>
<span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> var_names, <span class="dt">value =</span> obs_values)
<span class="kw">str</span>(gap_wide_new)</code></pre></div>
</div>
<div id="other-tidyr-awesomeness" class="section level2">
<h2><span class="header-section-number">8.13</span> Other tidyr awesomeness</h2>
<ul>
<li><code>complete()</code></li>
</ul>
<hr />
</div>
<div id="importing-data" class="section level2">
<h2><span class="header-section-number">8.14</span> Importing data</h2>
<p>We don’t have time to discuss importing data, but here are some packages by Hadley Wickham to explore and use. Remember you’ll use <code>install.packages(&quot;package-name-in-quotes&quot;)</code> and then <code>library(package-name)</code>, and then you can explore the help or vignettes. And also, of course, Google to see how to use them!</p>
<ul>
<li><code>readr</code> to read in .csv files</li>
<li><code>readxl</code> to read in Excel files</li>
<li><code>stringr</code> to work with strings</li>
<li><code>lubridate</code> to work with dates</li>
</ul>
</div>
<div id="other-links" class="section level2">
<h2><span class="header-section-number">8.15</span> Other links</h2>
<ul>
<li><a href="http://ucsb-bren.github.io/env-info/wk04_tidyr.html">Tidying up Data - Env Info</a> - <a href="https://github.com/ucsb-bren/env-info/blob/gh-pages/wk04_tidyr.Rmd">Rmd</a></li>
<li><a href="http://bbest.github.io/dplyr-tidyr-tutorial/">Data wrangling with dplyr and tidyr - Tyler Clavelle &amp; Dan Ovando</a> - <a href="https://github.com/bbest/dplyr-tidyr-tutorial/blob/gh-pages/index.Rmd">Rmd</a></li>
</ul>
</div>
<div id="troubleshooting-3" class="section level2">
<h2><span class="header-section-number">8.16</span> Troubleshooting</h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="wrangling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rmarkdown.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
